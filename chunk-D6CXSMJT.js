import{a}from"./chunk-BXZ6GHR6.js";import"./chunk-X5YLR3NI.js";import{c as w,e as v,l as C}from"./chunk-WALZ72ED.js";import{Da as c,Ia as u,Ma as d,Ra as p,ab as g,bb as r,cb as s,fb as f,gb as h,kb as l,lb as x}from"./chunk-F6HRXSUH.js";import{i as m}from"./chunk-ODN5LVDJ.js";function k(o,e){if(o&1&&(r(0,"p",4),l(1),s()),o&2){let t=h();c(),x(t.message)}}var b=class o{constructor(e){this.router=e}message="";ngOnInit(){return m(this,null,function*(){try{let t=new URLSearchParams(window.location.search).get("code"),n,i;if(t?{data:n,error:i}=yield a.auth.exchangeCodeForSession(t):(n=null,i=null),i&&console.warn("exchangeCodeForSession fejl (ikke kritisk):",i),n?.session??null){localStorage.setItem("admin","true"),this.router.navigate(["/edit"]);return}}catch(e){console.warn("Fejl i getSessionFromUrl:",e)}try{let{data:{session:e}}=yield a.auth.getSession();if(e){this.router.navigate(["/edit"]);return}}catch(e){console.warn("getSession fejl:",e)}a.auth.onAuthStateChange((e,t)=>{t&&(localStorage.setItem("admin","true"),this.router.navigate(["/edit"]))})})}startOAuth(){return m(this,null,function*(){try{if(window.location.search.includes("access_token")||window.location.search.includes("code")){this.message="Venter p\xE5 callback... pr\xF8v at genindl\xE6se hvis det ikke forts\xE6tter.";return}yield a.auth.signInWithOAuth({provider:"github",options:{redirectTo:"https://kimmassesson.dk/login"}})}catch(e){console.error("startOAuth fejl:",e),this.message="Fejl ved start af login. Pr\xF8v igen."}})}static \u0275fac=function(t){return new(t||o)(u(C))};static \u0275cmp=d({type:o,selectors:[["app-login"]],decls:6,vars:1,consts:[[1,"max-w-md","mx-auto","mt-10","p-6","bg-white","rounded-lg","shadow-md"],[1,"text-xl","font-semibold","mb-4"],[1,"bg-blue-500","text-white","px-4","py-2","rounded-md","w-full",3,"click"],["class","mt-4 text-sm text-red-500",4,"ngIf"],[1,"mt-4","text-sm","text-red-500"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h2",1),l(2,"Login"),s(),r(3,"button",2),f("click",function(){return n.startOAuth()}),l(4," Login med GitHub "),s(),p(5,k,2,1,"p",3),s()),t&2&&(c(5),g("ngIf",n.message))},dependencies:[v,w],encapsulation:2})};export{b as LoginComponent};
